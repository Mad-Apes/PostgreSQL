var url={next:"/v2/article/next.do",list:"/v2/article/list.do",add:"/v2/subscribe/add.do",rem:"/v2/subscribe/rem.do",status:"/v2/subscribe/sublist/"};!function(l){NTES.ready(function(e){var t=NTESCommonNavigator.core.Controller,i=NTESCommonNavigator.core.Event.Base;(NTESCommonNavigator.utils.app=t()).bind(i.DATA_CHANGED,function(e){location.reload()})});var c=l(".colum_article_lise_outer"),r=l(".colum_article_lise"),e=l('[data-toggle="js-follow"]'),t=y(),d=!0,u=!0,i=l("#contain"),o=i.data("wemediaid"),a=i.data("docid"),n=i.data("ptime"),s=l(".js-input-bar"),f=i.find(".video"),v=l("#content").data("cover").split(",");function m(){l(".s_loading").removeClass("hidden"),!(u=!0)!==r.data("current")&&function(){var s=r.height(),e=parseInt(r.data("current"))+1;l.ajax({url:url.list,type:"GET",dataType:"json",data:{pageNo:e,wemediaId:o,size:10}}).then(function(e){if(1!==e.code)return!1;if(0<e.data.list.length){var t,i,o={list:e.data.list},a=o.list.length;for(t=0;t<a;t++)"string"==typeof o.list[t].imgsrc&&(o.list[t].imgsrc=o.list[t].imgsrc.replace("bigimg||","").split("||")[0].trim(),(i=o.list[t].imgsrc.match(/\.(jpe?g|png|gif|bmp)$/i))&&1<i.length?o.list[t].imgsuffix=i[1]:o.list[t].imgsuffix="jpeg");r.append(template.compile(p)(o)),c.scrollTop(s);var n=!!e.data.hasNext&&e.data.pageNo;r.data("current",n)}!1===e.data.hasNext&&(d=!1,l(".s_loading").text("\u62c9\u5230\u5e95\u5566")),u=!1})}()}c.height(t),s.addClass("z-input-fold"),m(),h(url.next,{wemediaId:o,docid:a,ptime:n},function(e){1===e.code&&(null!==e.data?(l("#js-next").attr("href","/v2/article/detail/"+e.data.docid+".html").text(e.data.title),l("#js-next").closest(".next").removeClass("hidden")):l("#js-next").remove())},"GET"),l(".z-input-fold").on("click",".js-submit-btn",function(e){s.removeClass("z-input-fold")});var p='{{each list as value}}<li class="article_item{{if value.docid == "'+a+'"}} active {{/if}}" id="{{value.docid}}"><a class="content" href="/v2/article/detail/{{value.docid}}.html"><span class="item_time">{{value.ptime}}</span><p>{{value.title}}</p>{{if value.imgsrc && value.docid != "'+a+'"}}<div class="imghover"><img src="http://nimg.ws.126.net/?url={{value.imgsrc}}&thumbnail=260x150&quality=75&type={{value.imgsuffix}}" alt="\u56fe\u7247"></div>{{/if}}</a></li>{{/each}}';function h(e,t,i,o){l.ajax({url:e,type:o||"POST",dataType:"json",data:t}).then(function(e){i(e)})}e.on("click",function(e){var t=l(this);t.hasClass("active")?h(url.rem,{wemediaId:o},function(e){if(1!==e.code)return!1;t.removeClass("active").text("+ \u5173\u6ce8")}):h(url.add,{wemediaId:o},function(e){if(1===e.code)t.addClass("active"),t.html('<i class="onok"></i>\u5df2\u5173\u6ce8'),l(".followok").fadeIn();else if(-1===e.code)!function(e){var t=l("#"+e),i=t.find(".hw-layer-wrap");t.fadeIn(),i.css({"margin-top":-i.outerHeight()/2})}("hw-layer");else{if(100021!==e.code)return!1;l(".noLoginIn").fadeIn()}})}),l(".close_btn").on("click",function(){l(".followok").fadeOut()}),l(".close_warn").on("click",function(){l(".noLoginIn").fadeOut()}),e.on("mouseover",function(){l(this).hasClass("active")&&l(this).html("\u53d6\u6d88\u5173\u6ce8")}),e.on("mouseout",function(){l(this).hasClass("active")&&l(this).html('<i class="onok"></i>\u5df2\u5173\u6ce8')});var g=l(".colum_des");c.on("scroll",function(){var e=this,t=l(e).height();l(e).find("ul").height()-t-l(e).scrollTop()<=0&&0==u&&1==d&&setTimeout(m(),2e3),l(e).scrollTop()<100?g.removeClass("scrollHide"):g.hasClass("scrollHide")||(g.addClass("scrollHide"),l(e).height(y()))});var w=l(".to_show");if(w.is(":visible")){var x=w[0].offsetTop+w[0].offsetParent.offsetTop-105;l(document).on("scroll",function(){var e=l(this),t=l(".to_show");e.scrollTop()>x?t.addClass("z-fixed"):t.removeClass("z-fixed")})}function y(){return l(window).height()-c[0].offsetTop-c[0].offsetParent.offsetTop}function T(){l(".hw-overlay").fadeOut()}l(".gototop").on("click",function(){l(window).scrollTop(0)}),l(".special-share-weixin").on("click",function(e){l(".nt-wx2dcode-pop").css({top:"80px"}).fadeIn()}),l("body").on("click",".nt-wx2dcode-close",function(){l(".nt-wx2dcode-pop").fadeOut()}),l(".hwLayer-ok,.hwLayer-cancel,.hwLayer-close").on("click",function(){T()}),l(".hw-overlay").on("click",function(e){e.target==this&&T()}),l(document).keyup(function(e){27==e.keyCode&&T()}),l.each(f,function(e,t){l(t).after('<div class="video-root"><div class="cover js-cover" style="background: url('+v[e]+') no-repeat center center; background-size: 100% 100%"><div class="play-btn"></div></div></div>')}),l(".js-cover").on("click",function(e){e.preventDefault(),e.stopPropagation();var t=l(this),i=t.closest(".video-root").prev(".video")[0].innerHTML.replace(/(^\<\!--)|(--\>)/g,"");t.html(i)})}(jQuery);