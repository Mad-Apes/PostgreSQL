# INHERITS
```
    使用 create 创建一个新的子表时使用 inherits.如下
      CREATE TABLE IF	NOT EXISTS persons (
      "id" int4
      );

      CREATE TABLE IF	NOT EXISTS students (
      ) inherits(persons);
```
# 知识点及验证
##知识点汇总
```
    1：一个表可以从1或者多个表中继承，也可以定义自己的列，这个情况下子表拥有的列是所有主表的列和自己列的并集。
    2：出现重名的列时，这些列会被合并，重名列能合并的前提是必须拥有一致的数据类型。
    3：default 约束。约束可以被继承。如果子表中有重名字段并且有default约束，则继承可以成功。否则主表间的default约束必须一致才能继承成功。
    4：非空约束 可以被继承。
    5：check 约束。可以被继承，及时两个重名列的检查约束冲突，也会合并成功。子表该字段的检查约束是所有检查约束的并集。
    6：主键约束、唯一约束和外键约束不会被继承
    7：修改表名
    8：修改字段名称
    9：修改字段的数据类型
    10：修改字段的存储类型
    10：增加删除字段
    11：字段索引
    12：表的存储属性
    13：多层继承
    14：reindex 和 vacuum 命令不会影响到子表。
```

## 验证
### 一个表可以从1或者多个表中继承，也可以定义自己的列，这个情况下子表拥有的列是所有主表的列和自己列的并集。
```
    CREATE TABLE IF	NOT EXISTS persons (
    "id" int4,
    "name" text
    );

    CREATE TABLE IF	NOT EXISTS persons_2 (
    "id" int4,
    "age" int2
    );

    CREATE TABLE IF	NOT EXISTS students (
    "sex" boolean
    ) inherits(persons,persons_2);
    ------------------------------------------------------------------------
    执行结果：
    > NOTICE:  merging multiple inherited definitions of column "id"

    查看表结构：
    postgres=# \d+ persons
                                      Table "public.persons"
     Column |  Type   | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+---------+-----------+----------+---------+----------+--------------+-------------
     id     | integer |           |          |         | plain    |              |
     name   | text    |           |          |         | extended |              |
    Child tables: students

    postgres=# \d+ persons_2
                                     Table "public.persons_2"
     Column |   Type   | Collation | Nullable | Default | Storage | Stats target | Description
    --------+----------+-----------+----------+---------+---------+--------------+-------------
     id     | integer  |           |          |         | plain   |              |
     age    | smallint |           |          |         | plain   |              |
    Child tables: students

    postgres=# \d+ students
                                      Table "public.students"
     Column |   Type   | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+----------+-----------+----------+---------+----------+--------------+-------------
     id     | integer  |           |          |         | plain    |              |
     name   | text     |           |          |         | extended |              |
     age    | smallint |           |          |         | plain    |              |
     sex    | boolean  |           |          |         | plain    |              |
    Inherits: persons,
              persons_2
```
### 出现重名的列时，这些列会被合并，重名列能合并的前提是必须拥有一致的数据类型。
#### 重名字段数据类型一致 合并成功
```
    CREATE TABLE IF	NOT EXISTS persons (
    "id" int4
    );

    CREATE TABLE IF	NOT EXISTS students (
    "id" int4
    ) inherits(persons);
    ----------------------------------------------------------------------------------
    执行结果：
    > NOTICE:  merging column "id" with inherited definition

    表结构：
    postgres=# \d+ persons
                                      Table "public.persons"
     Column |  Type   | Collation | Nullable | Default | Storage | Stats target | Description
    --------+---------+-----------+----------+---------+---------+--------------+-------------
     id     | integer |           |          |         | plain   |              |
    Child tables: students

    postgres=# \d+ students
                                     Table "public.students"
     Column |  Type   | Collation | Nullable | Default | Storage | Stats target | Description
    --------+---------+-----------+----------+---------+---------+--------------+-------------
     id     | integer |           |          |         | plain   |              |
    Inherits: persons

```
#### 重名字段数据类型不一致 合并失败
```
    CREATE TABLE IF	NOT EXISTS persons (
    "id" int4
    );

    CREATE TABLE IF	NOT EXISTS students (
    "id" int2
    ) inherits(persons);
    -------------------------------------------------------------------------------------
    执行结果：
    > ERROR:  column "id" has a type conflict
      DETAIL:  integer versus smallint
```
### default 约束。约束可以被继承。如果子表中有重名字段并且有default约束，则继承可以成功。否则主表间的default约束必须一致才能继承成功。
#### default约束可以被继承
```
    CREATE TABLE IF	NOT EXISTS persons (
    "id" int4 DEFAULT 10
    );

    CREATE TABLE IF	NOT EXISTS students (
    "id" int4
    ) inherits(persons);
    ---------------------------------------------------------------------------------------
    执行结果：
    > NOTICE:  merging column "id" with inherited definition
    --------------------------------------------------------------------------------------
    表结构：
    postgres=# \d+ persons
                                      Table "public.persons"
     Column |  Type   | Collation | Nullable | Default | Storage | Stats target | Description
    --------+---------+-----------+----------+---------+---------+--------------+-------------
     id     | integer |           |          | 10      | plain   |              |
    Child tables: students

    postgres=# \d+ students
                                     Table "public.students"
     Column |  Type   | Collation | Nullable | Default | Storage | Stats target | Description
    --------+---------+-----------+----------+---------+---------+--------------+-------------
     id     | integer |           |          | 10      | plain   |              |
    Inherits: persons
```
#### 重名字段 - default约束 单表继承。主子表重名字段，如果子表有default约束依然使用自己的约束，否则使用主表的default约束。
```
    CREATE TABLE IF	NOT EXISTS persons (
    "name" text DEFAULT 'zhangsan'
    );

    CREATE TABLE IF	NOT EXISTS students (
    "name" text DEFAULT 'lisi'
    ) inherits(persons);
    ---------------------------------------------------------------------------------------------
    执行结果：
    > NOTICE:  merging column "name" with inherited definition
    ---------------------------------------------------------------------------------------------
    表结构：
    postgres=# \d+ persons
                                         Table "public.persons"
     Column | Type | Collation | Nullable |     Default      | Storage  | Stats target | Description
    --------+------+-----------+----------+------------------+----------+--------------+-------------
     name   | text |           |          | 'zhangsan'::text | extended |              |
    Child tables: students

    postgres=# \d+ students
                                       Table "public.students"
     Column | Type | Collation | Nullable |   Default    | Storage  | Stats target | Description
    --------+------+-----------+----------+--------------+----------+--------------+-------------
     name   | text |           |          | 'lisi'::text | extended |              |
    Inherits: persons
```
#### 重名字段 - default约束 多表继承。重名字段在字表中有且有自己的default约束，则使用子表的default约束。如果主表间重名字段的default不一致则继承不成功。
```
    **第一种情况 子表有自己的 default 约束**
    CREATE TABLE IF	NOT EXISTS persons (
    "name" text DEFAULT 'zhangsan'
    );

    CREATE TABLE IF	NOT EXISTS persons_2 (
    "name" text DEFAULT 'wangwu'
    );

    CREATE TABLE IF	NOT EXISTS students (
    "name" text DEFAULT 'lisi'
    ) inherits(persons,persons_2);
    --------------------------------------------------------------------------------------------------
    执行结果：
    > NOTICE:  merging column "name" with inherited definition
    --------------------------------------------------------------------------------------------------
    表结构：
    postgres=# \d+ persons
                                         Table "public.persons"
     Column | Type | Collation | Nullable |     Default      | Storage  | Stats target | Description
    --------+------+-----------+----------+------------------+----------+--------------+-------------
     name   | text |           |          | 'zhangsan'::text | extended |              |
    Child tables: students

    postgres=# \d+ persons_2
                                       Table "public.persons_2"
     Column | Type | Collation | Nullable |    Default     | Storage  | Stats target | Description
    --------+------+-----------+----------+----------------+----------+--------------+-------------
     name   | text |           |          | 'wangwu'::text | extended |              |
    Child tables: students

    postgres=# \d+ students
                                       Table "public.students"
     Column | Type | Collation | Nullable |   Default    | Storage  | Stats target | Description
    --------+------+-----------+----------+--------------+----------+--------------+-------------
     name   | text |           |          | 'lisi'::text | extended |              |
    Inherits: persons,
              persons_2
==============================================================================================================================
    **第二种情况 子表没有有自己的 default 约束**
    CREATE TABLE IF	NOT EXISTS persons (
    "name" text DEFAULT 'zhangsan'
    );

    CREATE TABLE IF	NOT EXISTS persons_2 (
    "name" text DEFAULT 'wangwu'
    );

    CREATE TABLE IF	NOT EXISTS students (
    "name" text
    ) inherits(persons,persons_2);
    --------------------------------------------------------------------------------------------------
    执行结果：
    > ERROR:  column "name" inherits conflicting default values
      HINT:  To resolve the conflict, specify a default explicitly.
```
### 非空约束 可以被继承。多表继承，主表间重名字段非空约束可能不一样，但是not null 的约束会被子表继承来。
```
    CREATE TABLE IF	NOT EXISTS persons (
    "name" text not null
    );

    CREATE TABLE IF	NOT EXISTS students (
    "name" text
    ) inherits(persons);
    --------------------------------------------------------------------------------------------------
    执行结果：
    > NOTICE:  merging column "name" with inherited definition
    --------------------------------------------------------------------------------------------------
    表结构：
    postgres=# \d+ persons
                                     Table "public.persons"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           | not null |         | extended |              |
    Child tables: students

    postgres=# \d+ students
                                    Table "public.students"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           | not null |         | extended |              |
    Inherits: persons


    **多表继承**
    CREATE TABLE IF	NOT EXISTS persons (
    "name" text not null
    );

    CREATE TABLE IF	NOT EXISTS persons_2 (
    "name" text
    );

    CREATE TABLE IF	NOT EXISTS students (
    "name" text
    ) inherits(persons,persons_2);

    执行结果：
    > NOTICE:  merging multiple inherited definitions of column "name"

      NOTICE:  merging column "name" with inherited definition

    表结构
    postgres=# \d+ persons
                                     Table "public.persons"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           | not null |         | extended |              |
    Child tables: students

    postgres=# \d+ persons_2
                                    Table "public.persons_2"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Child tables: students

    postgres=# \d+ students
                                    Table "public.students"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           | not null |         | extended |              |
    Inherits: persons,
              persons_2
```
### check 约束。可以被继承，即使两个重名列的检查约束冲突，也会合并成功。子表该字段的检查约束是所有检查约束的并集。
```
    CREATE TABLE IF	NOT EXISTS persons (
    "name" text CHECK(LENGTH(name)>10)
    );

    CREATE TABLE IF	NOT EXISTS students (
    "name" text
    ) inherits(persons);
    ----------------------------------------------------------------------------------------
    执行结果：
    > NOTICE:  merging column "name" with inherited definition

    表结构：
    postgres=# \d+ persons
                                     Table "public.persons"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Check constraints:
        "persons_name_check" CHECK (length(name) > 10)
    Child tables: students

    postgres=# \d+ students
                                    Table "public.students"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Check constraints:
        "persons_name_check" CHECK (length(name) > 10)
    Inherits: persons

```

```
    CREATE TABLE IF	NOT EXISTS persons (
    "name" text CHECK(LENGTH(name)>10)
    );

    CREATE TABLE IF	NOT EXISTS students (
    "name" text CHECK(LENGTH(name)<7)
    ) inherits(persons);
    -----------------------------------------------------------------------------------------
    执行结果
    > NOTICE:  merging column "name" with inherited definition
    -----------------------------------------------------------------------------------------
    postgres=# \d+ persons
                                     Table "public.persons"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Check constraints:
        "persons_name_check" CHECK (length(name) > 10)
    Child tables: students

    postgres=# \d+ students
                                    Table "public.students"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Check constraints:
        "persons_name_check" CHECK (length(name) > 10)
        "students_name_check" CHECK (length(name) < 7)
    Inherits: persons
```
```
    CREATE TABLE IF	NOT EXISTS persons (
    "name" text CHECK(LENGTH(name)>100)
    );

    CREATE TABLE IF	NOT EXISTS persons_2 (
    "name" text CHECK(LENGTH(name)<10)
    );

    CREATE TABLE IF	NOT EXISTS students (
    "name" text CHECK(LENGTH(name)=50)
    ) inherits(persons,persons_2);

    执行结果：
    > NOTICE:  merging multiple inherited definitions of column "name"

      NOTICE:  merging column "name" with inherited definition

    表结构：
    postgres=# \d+ persons
                                     Table "public.persons"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Check constraints:
        "persons_name_check" CHECK (length(name) > 100)
    Child tables: students

    postgres=# \d+ persons_2
                                    Table "public.persons_2"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Check constraints:
        "persons_2_name_check" CHECK (length(name) < 10)
    Child tables: students

    postgres=# \d+ students
                                    Table "public.students"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Check constraints:
        "persons_2_name_check" CHECK (length(name) < 10)
        "persons_name_check" CHECK (length(name) > 100)
        "students_name_check" CHECK (length(name) = 50)
    Inherits: persons,
              persons_2  

```
### 主键约束、唯一约束和外键约束不会被继承
#### 约束的继承规则 - 唯一约束 - 不被继承
```
    CREATE TABLE IF NOT EXISTS "foo"(
    "id" int2,
    "name" text,
    CONSTRAINT must_different_unique UNIQUE(id,name)
    )
    WITH(OIDS=FALSE);

    CREATE TABLE IF NOT EXISTS "son"(
    )inherits(foo)
    WITH(OIDS=FALSE);

    -- 查看表结构
    postgres=# \d+ foo
                                         Table "public.foo"
     Column |   Type   | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+----------+-----------+----------+---------+----------+--------------+-------------
     id     | smallint |           |          |         | plain    |              |
     name   | text     |           |          |         | extended |              |
    Indexes:
        "must_different_unique" UNIQUE CONSTRAINT, btree (id, name)
    Child tables: son

    postgres=# \d+ son
                                         Table "public.son"
     Column |   Type   | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+----------+-----------+----------+---------+----------+--------------+-------------
     id     | smallint |           |          |         | plain    |              |
     name   | text     |           |          |         | extended |              |
    Inherits: foo

```
#### 约束的继承规则 - 主键约束 - 不被继承
```
    CREATE TABLE IF NOT EXISTS "foo"(
    "id" int2 primary key
    )
    WITH(OIDS=FALSE);

    CREATE TABLE IF NOT EXISTS "son"(
    )inherits(foo)
    WITH(OIDS=FALSE);

    -- 查看表结构
    postgres=# \d+ foo
                                        Table "public.foo"
     Column |   Type   | Collation | Nullable | Default | Storage | Stats target | Description
    --------+----------+-----------+----------+---------+---------+--------------+-------------
     id     | smallint |           | not null |         | plain   |              |
    Indexes:
        "foo_pkey" PRIMARY KEY, btree (id)
    Child tables: son

    postgres=# \d+ son
                                        Table "public.son"
     Column |   Type   | Collation | Nullable | Default | Storage | Stats target | Description
    --------+----------+-----------+----------+---------+---------+--------------+-------------
     id     | smallint |           | not null |         | plain   |              |
    Inherits: foo
```
#### 约束的继承规则 - 外键约束 - 不被继承
```
    CREATE TABLE IF NOT EXISTS "super_foo"(
    "super_id" int2 PRIMARY KEY
    )
    WITH(OIDS=FALSE);

    CREATE TABLE IF NOT EXISTS "foo"(
    "id" int2 references super_foo(super_id)
    )
    WITH(OIDS=FALSE);

    CREATE TABLE IF NOT EXISTS "son"(
    )inherits(foo)
    WITH(OIDS=FALSE);

    -- 查看表结构

    postgres=# \d+ super_foo
                                      Table "public.super_foo"
      Column  |   Type   | Collation | Nullable | Default | Storage | Stats target | Description
    ----------+----------+-----------+----------+---------+---------+--------------+-------------
     super_id | smallint |           | not null |         | plain   |              |
    Indexes:
        "super_foo_pkey" PRIMARY KEY, btree (super_id)
    Referenced by:
        TABLE "foo" CONSTRAINT "foo_id_fkey" FOREIGN KEY (id) REFERENCES super_foo(super_id)

    postgres=# \d+ foo
                                        Table "public.foo"
     Column |   Type   | Collation | Nullable | Default | Storage | Stats target | Description
    --------+----------+-----------+----------+---------+---------+--------------+-------------
     id     | smallint |           |          |         | plain   |              |
    Foreign-key constraints:
        "foo_id_fkey" FOREIGN KEY (id) REFERENCES super_foo(super_id)
    Child tables: son

    postgres=# \d+ son
                                        Table "public.son"
     Column |   Type   | Collation | Nullable | Default | Storage | Stats target | Description
    --------+----------+-----------+----------+---------+---------+--------------+-------------
     id     | smallint |           |          |         | plain   |              |
    Inherits: foo

```
### 修改表名。修改主表表名会影响子表，修改子表表名同样会影响主表。
```
    postgres=# \d+ persons
                                     Table "public.persons"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Child tables: students

    postgres=# \d+ students
                                    Table "public.students"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Inherits: persons

    postgres=# alter table persons rename to ppp;
    ALTER TABLE
    postgres=# \d+ ppp
                                       Table "public.ppp"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Child tables: students

    postgres=# \d+ students
                                    Table "public.students"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Inherits: ppp

    postgres=# alter table students rename to stu;
    ALTER TABLE
    postgres=#
    postgres=# \d+ ppp
                                       Table "public.ppp"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Child tables: stu

    postgres=# \d+ stu
                                       Table "public.stu"
     Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
    --------+------+-----------+----------+---------+----------+--------------+-------------
     name   | text |           |          |         | extended |              |
    Inherits: ppp

```
### 修改字段名称
#### 修改主表字段名字，成功并影响后代表。
```
postgres=# \d+ persons
                                 Table "public.persons"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Child tables: students

postgres=# \d+ students
                                Table "public.students"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Inherits: persons

postgres=# alter table persons rename name to person_name;
ALTER TABLE
postgres=# \d+ persons
                                   Table "public.persons"
   Column    | Type | Collation | Nullable | Default | Storage  | Stats target | Description
-------------+------+-----------+----------+---------+----------+--------------+-------------
 person_name | text |           |          |         | extended |              |
Child tables: students

postgres=# \d+ students
                                   Table "public.students"
   Column    | Type | Collation | Nullable | Default | Storage  | Stats target | Description
-------------+------+-----------+----------+---------+----------+--------------+-------------
 person_name | text |           |          |         | extended |              |
Inherits: persons
```
#### 修改子表的继承来的字段名字，不成功。
```
postgres=# \d+ persons
                                 Table "public.persons"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Child tables: students

postgres=# \d+ students
                                Table "public.students"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Inherits: persons

postgres=#
postgres=# alter table students rename name to stu_name;
ERROR:  cannot rename inherited column "name"

```
### 修改字段的数据类型
#### 修改主表字段类型。修改成功，影响所有后代表。
```
postgres=# \d+ persons
                                 Table "public.persons"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Child tables: students

postgres=# \d+ students
                                Table "public.students"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Inherits: persons

postgres=# alter table persons alter name type varchar(20);
ALTER TABLE
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | extended |              |
Child tables: students

postgres=# \d+ students
                                         Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | extended |              |
Inherits: persons
```
#### 修改后代表继承过来的表字段数据类型。不允许
```
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | extended |              |
Child tables: students

postgres=# \d+ students
                                         Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | extended |              |
Inherits: persons

postgres=#
postgres=# alter table students alter name type int2;
ERROR:  cannot alter inherited column "name"
```
### 修改字段的存储类型
#### 修改主表字段的存储策略，成功，影响所有后代。
```
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | extended |              |
Child tables: students

postgres=# \d+ students
                                         Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | extended |              |
Inherits: persons

postgres=# alter table persons alter column name set storage external;
ALTER TABLE
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
Child tables: students

postgres=# \d+ students
                                         Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
Inherits: persons

```
#### 修改子表继承过来的字段存储策略。成功，但是只是影响了自己的存储策略，主表该字段的存储策略不会受影响。
```
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
Child tables: students

postgres=# \d+ students
                                         Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
Inherits: persons

postgres=# alter table students alter name set storage plain;
ALTER TABLE
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
Child tables: students

postgres=# \d+ students
                                        Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage | Stats target | Description
--------+-----------------------+-----------+----------+---------+---------+--------------+-------------
 name   | character varying(20) |           |          |         | plain   |              |
Inherits: persons
```
### 增加删除字段
#### 主表增加、删除字段。成功，并影响所有子表。
```
增加字段
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
Child tables: students

postgres=# \d+ students
                                        Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage | Stats target | Description
--------+-----------------------+-----------+----------+---------+---------+--------------+-------------
 name   | character varying(20) |           |          |         | plain   |              |
Inherits: persons

postgres=# alter table persons add column age int2;
ALTER TABLE
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
 age    | smallint              |           |          |         | plain    |              |
Child tables: students

postgres=# \d+ students
                                        Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage | Stats target | Description
--------+-----------------------+-----------+----------+---------+---------+--------------+-------------
 name   | character varying(20) |           |          |         | plain   |              |
 age    | smallint              |           |          |         | plain   |              |
Inherits: persons

```
```
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
 age    | smallint              |           |          |         | plain    |              |
Child tables: students

postgres=# \d+ students
                                        Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage | Stats target | Description
--------+-----------------------+-----------+----------+---------+---------+--------------+-------------
 name   | character varying(20) |           |          |         | plain   |              |
 age    | smallint              |           |          |         | plain   |              |
Inherits: persons

postgres=# alter table persons drop column age;
ALTER TABLE
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
Child tables: students

postgres=# \d+ students
                                        Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage | Stats target | Description
--------+-----------------------+-----------+----------+---------+---------+--------------+-------------
 name   | character varying(20) |           |          |         | plain   |              |
Inherits: persons
```
#### 子表新增、删除字段。当只有删除继承过来的字段时不允许。
```
postgres=# \d+ persons
                                         Table "public.persons"
 Column |         Type          | Collation | Nullable | Default | Storage  | Stats target | Description
--------+-----------------------+-----------+----------+---------+----------+--------------+-------------
 name   | character varying(20) |           |          |         | external |              |
Child tables: students

postgres=# \d+ students
                                        Table "public.students"
 Column |         Type          | Collation | Nullable | Default | Storage | Stats target | Description
--------+-----------------------+-----------+----------+---------+---------+--------------+-------------
 name   | character varying(20) |           |          |         | plain   |              |
Inherits: persons

postgres=# alter table students drop column name;
ERROR:  cannot drop inherited column "name"

```
### 字段索引 索引不会被继承
```

CREATE TABLE IF	NOT EXISTS persons (
"name" text
);

create INDEX idx_persons_name ON persons(name);

CREATE TABLE IF	NOT EXISTS students (
"name" text
) inherits(persons);

------------------------------------------------------------------------------
postgres=# \d+ persons
                                 Table "public.persons"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Indexes:
    "idx_persons_name" btree (name)
Child tables: students

postgres=# \d+ students
                                Table "public.students"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Inherits: persons

```
### 表的存储属性。表的存储属性不会被继承
```
CREATE TABLE IF	NOT EXISTS persons (
"name" text
)WITH(OIDS=FALSE, fillfactor=60,parallel_workers=10);

CREATE TABLE IF	NOT EXISTS students (
"name" text
) inherits(persons);

----------------------------------------------------------------------------------------
postgres=# \d+ persons
                                 Table "public.persons"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Child tables: students
Options: fillfactor=60, parallel_workers=10

postgres=# \d+ students
                                Table "public.students"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Inherits: persons
```

### 多层继承 可以继承 规则和上面一样。
```
CREATE TABLE IF	NOT EXISTS persons (
"name" text
)WITH(OIDS=FALSE, fillfactor=60,parallel_workers=10);

CREATE TABLE IF	NOT EXISTS students (
"age" int2
) inherits(persons);

CREATE TABLE IF NOT EXISTS freshman(
"sex" BOOLEAN
)inherits(students);
-------------------------------------------------------------------------------------------
执行结果：
CREATE TABLE IF	NOT EXISTS persons (
"name" text
)WITH(OIDS=FALSE, fillfactor=60,parallel_workers=10)
> OK
> Time: 0.102s


CREATE TABLE IF	NOT EXISTS students (
"age" int2
) inherits(persons)
> OK
> Time: 0.083s


CREATE TABLE IF NOT EXISTS freshman(
"sex" BOOLEAN
)inherits(students)
> OK
> Time: 0.051s
-------------------------------------------------------------------------------------------
表结构：
postgres=# \d+ persons
                                 Table "public.persons"
 Column | Type | Collation | Nullable | Default | Storage  | Stats target | Description
--------+------+-----------+----------+---------+----------+--------------+-------------
 name   | text |           |          |         | extended |              |
Child tables: students
Options: fillfactor=60, parallel_workers=10

postgres=# \d+ students
                                  Table "public.students"
 Column |   Type   | Collation | Nullable | Default | Storage  | Stats target | Description
--------+----------+-----------+----------+---------+----------+--------------+-------------
 name   | text     |           |          |         | extended |              |
 age    | smallint |           |          |         | plain    |              |
Inherits: persons
Child tables: freshman

postgres=# \d+ freshman
                                  Table "public.freshman"
 Column |   Type   | Collation | Nullable | Default | Storage  | Stats target | Description
--------+----------+-----------+----------+---------+----------+--------------+-------------
 name   | text     |           |          |         | extended |              |
 age    | smallint |           |          |         | plain    |              |
 sex    | boolean  |           |          |         | plain    |              |
Inherits: students
```
### reindex 和 vacuum 命令不会影响到子表。
